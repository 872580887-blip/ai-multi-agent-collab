#!/bin/bash\n# diagnose-session.sh â€”â€” Collab-in-a-Box æ ¸å¿ƒå¯åŠ¨å™¨\n# ç”¨æ³•ï¼š./diagnose-session.sh --task "åˆ†æè¿™ä»½æ—¥å¿—" --timeout 10m\n\nset -e\n\nTASK=""\nTIMEOUT="10m"\nTEMP_DIR=""\n\nprint_usage() {\n  echo "Usage: $0 --task \"<ä»»åŠ¡æè¿°>\" [--timeout <duration>] [--help]"\n  echo "  --task      ä»»åŠ¡æè¿°ï¼ˆå¿…å¡«ï¼‰"\n  echo "  --timeout   è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ 10mï¼‰"\n  echo "  --help      æ˜¾ç¤ºæ­¤å¸®åŠ©"\n}\n\nwhile [[ $# -gt 0 ]]; do\n  case $1 in\n    --task)\n      TASK=\"$2\"\n      shift 2\n      ;;\n    --timeout)\n      TIMEOUT=\"$2\"\n      shift 2\n      ;;\n    --help|-h)\n      print_usage\n      exit 0\n      ;;\n    *)\n      echo "æœªçŸ¥å‚æ•°: $1"\n      print_usage\n      exit 1\n      ;;\n  esac\ndone\n\nif [[ -z \"$TASK\" ]]; then\n  echo \"âŒ é”™è¯¯ï¼š--task å‚æ•°ä¸ºå¿…å¡«é¡¹\"\n  print_usage\n  exit 1\nfi\n\n# åˆ›å»ºä¸´æ—¶ä¼šè¯ç›®å½•ï¼ˆéš”ç¦»ï¼‰\nTEMP_DIR=$(mktemp -d -t collab-session-XXXXXX)\necho \"ğŸ“ åˆ›å»ºä¸´æ—¶ä¼šè¯ç›®å½•ï¼š$TEMP_DIR\"\n\n# å¯åŠ¨æ¡¥æ¥æœåŠ¡ï¼ˆç›‘å¬ä¸´æ—¶ç›®å½•ï¼‰\nnode /Users/mac/Desktop/æ˜¯/ai-multi-agent-collab/src/bridge-server.js \n  --message-dir \"$TEMP_DIR\" \n  --port 8768 > \"$TEMP_DIR/bridge.log\" 2>&1 &\n\nBRIDGE_PID=$!\necho \"ğŸŒ å¯åŠ¨æ¡¥æ¥æœåŠ¡ï¼ˆç«¯å£ 8768ï¼‰â†’ PID $BRIDGE_PID\"\n\n# å¯åŠ¨ RPA ç›‘å¬ï¼ˆç›‘å¬ä¸´æ—¶ç›®å½•ï¼‰\nnode /Users/mac/Desktop/æ˜¯/ai-multi-agent-collab/src/rpa-notifier.js \n  --message-dir \"$TEMP_DIR\" > \"$TEMP_DIR/notifier.log\" 2>&1 &\n\nNOTIFIER_PID=$!\necho \"ğŸ¤– å¯åŠ¨ RPA é€šçŸ¥å™¨ â†’ PID $NOTIFIER_PID\"\n\n# å†™å…¥ä»»åŠ¡æ¶ˆæ¯\nTIMESTAMP=$(date +%s)\nMSG_FILE=\"$TEMP_DIR/msg-$TIMESTAMP.json\"\ncat > \"$MSG_FILE\" << EOF\n{\n  \"timestamp\": $TIMESTAMP,\n  \"sender\": \"user\",\n  \"senderName\": \"ç”¨æˆ·\",\n  \"message\": \"$TASK\"\n}\nEOF\necho \"ğŸ“© å·²å†™å…¥ä»»åŠ¡ï¼š$TASK\"\n\n# ç­‰å¾…è¶…æ—¶æˆ–å®Œæˆï¼ˆæ£€æµ‹ report-template.md æ˜¯å¦è¢«å¡«å……ï¼‰\necho \"â³ å¼€å§‹è¯Šæ–­ä¼šè¯ï¼ˆè¶…æ—¶ï¼š$TIMEOUTï¼‰...\"\nsleep 2  # ç¡®ä¿æœåŠ¡å°±ç»ª\n\n# ç®€å•å®Œæˆæ£€æµ‹ï¼ˆçœŸå®ç‰ˆå¯å¯¹æ¥ OpenClaw å›å¤ï¼‰\nif timeout \"$TIMEOUT\" bash -c \"\n  for i in {1..60}; do\n    if [ -f '$TEMP_DIR/report-final.md' ]; then\n      echo 'âœ… æŠ¥å‘Šå·²ç”Ÿæˆ'\n      exit 0\n    fi\n    sleep 1\n  done\n  echo 'âŒ è¶…æ—¶ï¼šæœªæ”¶åˆ°æŠ¥å‘Š'\n  exit 1\n\"; then\n  echo \"ğŸ‰ ä¼šè¯æˆåŠŸå®Œæˆï¼æŠ¥å‘Šå·²ç”Ÿæˆã€‚\"\nelse\n  echo \"âš ï¸  ä¼šè¯è¶…æ—¶ï¼Œæ­£åœ¨æ¸…ç†...\"\n  kill $BRIDGE_PID $NOTIFIER_PID 2>/dev/null || true\n  rm -rf \"$TEMP_DIR\"\n  exit 1\nfi\n\n# æ¸…ç†ï¼ˆä¿ç•™ report-final.mdï¼‰\nkill $BRIDGE_PID $NOTIFIER_PID 2>/dev/null || true\necho \"ğŸ§¹ æœåŠ¡å·²åœæ­¢ï¼Œä¸´æ—¶ç›®å½•ä¿ç•™ï¼ˆå« report-final.mdï¼‰\"\n